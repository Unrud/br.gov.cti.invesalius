{
    "app-id": "br.gov.cti.invesalius",
    "runtime": "org.gnome.Platform",
    "runtime-version": "3.32",
    "sdk": "org.gnome.Sdk",
    "command": "runner.sh",
    "copy-icon": true,
    "finish-args": [
        "--share=ipc",
        "--socket=x11",
        "--device=dri",
        "--share=network",
        "--filesystem=home",
        "--filesystem=/media",
        "--filesystem=/run/media",
        "--filesystem=xdg-run/dconf",
        "--filesystem=~/.config/dconf:ro",
        "--talk-name=ca.desrt.dconf",
        "--env=DCONF_USER_CONFIG_DIR=.config/dconf"
    ],
    "cleanup": [
        "/include",
        "/lib/pkgconfig",
        "/lib/cmake",
        "/share/cmake",
        "/share/doc",
        "/share/hdf5_examples"
    ],
    "modules": [{
        "name": "vtk",
        "builddir": true,
        "build-options": {
            "cxxflags": "-fpermissive"
        },
        "sources": [
            {
                "type": "archive",
                "url": "https://www.vtk.org/files/release/8.2/VTK-8.2.0.tar.gz",
                "sha256": "34c3dc775261be5e45a8049155f7228b6bd668106c72a3c435d95730d17d57bb"
            }
        ],
        "buildsystem": "cmake-ninja",
        "config-opts": [
            "-DBUILD_DOCUMENTATION=OFF",
            "-DBUILD_EXAMPLES=OFF",
            "-DBUILD_SHARED_LIBS=ON",
            "-DOpenGL_GL_PREFERENCE=GLVND",
            "-DVTK_USE_TK=OFF",
            "-DVTK_WRAP_JAVA=OFF",
            "-DVTK_WRAP_PYTHON=ON",
            "-DVTK_WRAP_TCL=OFF",
            "-DCMAKE_BUILD_TYPE=Release",
            "-DPYTHON_EXECUTABLE=/usr/bin/python3"
        ],
        "cleanup": [
            "/bin"
        ]
    },
    {
        "name": "swig",
        "sources":[{
            "type": "archive",
            "url": "http://prdownloads.sourceforge.net/swig/swig-3.0.12.tar.gz",
            "sha256": "7cf9f447ae7ed1c51722efc45e7f14418d15d7a1e143ac9f09a668999f4fc94d"
        }],
        "config-opts": [
            "--without-pcre",
            "--disable-ccache",
            "--without-tcl",
            "--without-tcl",
            "--without-perl5",
            "--without-octave",
            "--without-scilab",
            "--without-java",
            "--without-ruby"
        ],
        "cleanup": [
            "*"
        ]
    },
    {
        "name": "gdcm",
        "builddir": true,
        "sources": [{
            "type": "archive",
            "url": "https://github.com/malaterre/GDCM/archive/v3.0.0.tar.gz",
            "sha256": "3de524690102bfa3e9c3a81ff3f17733138183f76b7a5f7d072b20024a255680"
        }],
        "buildsystem": "cmake-ninja",
        "config-opts": [
            "-DGDCM_BUILD_APPLICATIONS=OFF",
            "-DGDCM_BUILD_SHARED_LIBS=ON",
            "-DCMAKE_BUILD_TYPE=Release",
            "-DGDCM_WRAP_PYTHON=ON",
            "-DPYTHON_EXECUTABLE=/usr/bin/python3",
            "-DGDCM_INSTALL_PYTHONMODULE_DIR=/app/lib/python3.7/site-packages/",
            "-DGDCM_USE_VTK=ON",
            "-DGDCM_BUILD_DOCBOOK_MANPAGES:BOOL=OFF"
        ],
        "cleanup": [
            "/bin"
        ]
    },
    {
        "name": "lapack",
        "buildsystem": "cmake",
        "builddir": true,
        "config-opts": [
            "-DCMAKE_BUILD_TYPE=Release",
            "-DBUILD_SHARED_LIBS=ON",
            "-DBUILD_TESTING=OFF",
            "-DLAPACKE=ON",
            "-DCBLAS=ON"
        ],
        "sources": [
            {
                "type": "archive",
                "url": "http://www.netlib.org/lapack/lapack-3.8.0.tar.gz",
                "sha512": "17786cb7306fccdc9b4a242de7f64fc261ebe6a10b6ec55f519deb4cb673cb137e8742aa5698fd2dc52f1cd56d3bd116af3f593a01dcf6770c4dcc86c50b2a7f"
            }
        ]
    },
    "shared-modules/glu/glu-9.0.0.json",
    "python3-numpy.json",
    "python3-scipy.json",
    "python3-Pillow.json",
    "python3-cython.json",
    "python3-pathlib2.json",
    "python3-wxpython.json",
    "python3-setuptools_scm.json",
    "python3-wheel.json",
    "python3-python-dateutil.json",
    "python3-matplotlib.json",
    "python3-scikit-image.json",
    "python3-bz2file.json",
    "python3-nibabel.json",
    "python3-pyserial.json",
    "python3-psutil.json",
    {
        "name" : "hdf5",
        "no-autogen" : true,
        "sources" : [
            {
                "type" : "archive",
                "url" : "https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.10/hdf5-1.10.4/src/hdf5-1.10.4.tar.bz2",
                "sha256" : "1267ff06aaedc04ca25f7c6026687ea2884b837043431195f153401d942b28df"
            }
        ]
    },
    {
        "name" : "py_pkgconfig",
        "buildsystem": "simple",
        "build-commands": [
            "pip3 install --no-index --find-links=\"file://${PWD}\" --prefix=${FLATPAK_DEST} pkgconfig"
        ],
        "sources" : [
        {
            "type": "file",
            "url": "https://files.pythonhosted.org/packages/b4/2c/bf434cb5a6590417e1d4468050ec317ea17fd6231c2a256df4646c11e588/pkgconfig-1.5.1-py2.py3-none-any.whl",
            "sha256": "cddf2d7ecadb272178a942eb852a9dee46bda2adcc36c3416b0fef47a4ed9f38"
        }
        ]
    },
    "python3-h5py.json",
    {
        "name": "invesalius",
        "buildsystem": "simple",
        "build-commands": [
            "python3 setup.py build_ext --inplace",
            "mkdir -p ${FLATPAK_DEST}/invesalius",
            "cp -r * ${FLATPAK_DEST}/invesalius/"
        ],
        "cleanup": [
            "/invesalius/build",
            "/invesalius/contrib",
            "/invesalius/po",
            "/invesalius/Dockerfile",
            "/invesalius/docs/devel",
            "/invesalius/docs/user_guide_en_source",
            "/invesalius/docs/user_guide_figures",
            "/invesalius/docs/user_guide_pt_BR_source",
            "*.pyx",
            "*.pxd",
            "*.cpp",
            "*.c",
            "*.*ignore",
            "*.git"
        ],
        "sources": [
            {
                "type": "archive",
                "url": "https://github.com/invesalius/invesalius3/archive/v3.1.99994.tar.gz",
                "sha256": "493aff36e000f3a98aad5b6532fd2e0f960e779a6db2821390f05e5c9e2067eb"
            },
            {
                "type": "patch",
                "path": "comment_immediate_rendering.patch"
            },
            {
                "type": "patch",
                "path": "not_create_tempdir.patch"
            }
        ]
    },
    {
        "name": "runner",
        "buildsystem": "simple",
        "build-commands": [
            "install -D runner.sh /app/bin/runner.sh"
        ],
        "sources": [
            {
                "type": "script",
                "dest-filename": "runner.sh",
                "commands": [
                    "cd /app/invesalius",
                    "exec python3 app.py \"$@\""
                ]
            }
        ]
    },
    {
        "name": "metadata",
        "buildsystem": "simple",
        "build-commands": [
            "install -D -t /app/share/applications/ br.gov.cti.invesalius.desktop",
            "install -D -t /app/share/icons/hicolor/256x256/apps/ br.gov.cti.invesalius.png",
            "install -D -t /app/share/appdata/ br.gov.cti.invesalius.appdata.xml"
        ],
        "sources": [
            {
                "type": "file",
                "path": "br.gov.cti.invesalius.desktop"
            },
            {
                "type": "file",
                "path": "br.gov.cti.invesalius.png"
            },
            {
                "type": "file",
                "path": "br.gov.cti.invesalius.appdata.xml"
            }
        ]
    }
    ]
}
